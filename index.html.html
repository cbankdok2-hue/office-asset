<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Office Asset List - Import Fix (v8.0)</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f9;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    input, button {
      padding: 8px;
      margin: 5px;
      font-size: 14px;
    }
    input[type="text"] {
      width: 250px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    .danger {
      background: #dc3545;
    }
    .danger:hover {
      background: #b52b36;
    }
    .edit {
      background: #28a745;
    }
    .edit:hover {
      background: #1f7f34;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: left;
    }
    th {
      background: #007bff;
      color: white;
    }
    tr:nth-child(even) {
      background: #f9f9f9;
    }
    #statusMessage {
      display: none;
      text-align: center;
      margin: 10px 0;
      padding: 10px;
      background: #e7f3fe;
      color: #00529b;
      border: 1px solid #b3d4fc;
      border-radius: 6px;
    }
    .search-boxes {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Office Asset List (v8.0)</h1>

    <div class="search-boxes">
      <input type="text" id="searchInput" placeholder="Search Equipment or User...">
      <input type="text" id="searchDok" placeholder="Search DOK B-CORD...">
      <button onclick="addAsset()">Add New</button>
      <button onclick="document.getElementById('fileInput').click()">Import Excel</button>
      <input type="file" id="fileInput" accept=".xlsx, .xls, .csv" style="display:none;">
      <button onclick="exportToCSV()">Export CSV</button>
      <button class="danger" onclick="clearAll()">Clear All Data</button>
    </div>

    <div id="statusMessage"></div>

    <table id="assetTable">
      <thead>
        <tr>
          <th>INDEX</th>
          <th>Equipment</th>
          <th>Equipment Description</th>
          <th>Serial Number</th>
          <th>DOK B-CORD</th>
          <th>User</th>
          <th>Location</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    let assetList = JSON.parse(localStorage.getItem('assetList') || '[]');

    function showStatus(msg, duration = 3000) {
      const box = document.getElementById("statusMessage");
      box.style.display = "block";
      box.textContent = msg;
      setTimeout(() => (box.style.display = "none"), duration);
    }

    function saveData() {
      localStorage.setItem('assetList', JSON.stringify(assetList));
      renderTable();
    }

    function renderTable() {
      const tbody = document.querySelector("#assetTable tbody");
      const searchValue = document.getElementById("searchInput").value.toLowerCase();
      const searchDok = document.getElementById("searchDok").value.toLowerCase();
      tbody.innerHTML = "";

      assetList
        .filter(a =>
          (a.equipment.toLowerCase().includes(searchValue) ||
           a.user.toLowerCase().includes(searchValue)) &&
          a.dok.toLowerCase().includes(searchDok)
        )
        .forEach((asset, index) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${index + 1}</td>
            <td>${asset.equipment}</td>
            <td>${asset.description}</td>
            <td>${asset.serial}</td>
            <td>${asset.dok}</td>
            <td>${asset.user}</td>
            <td>${asset.location}</td>
            <td>
              <button class="edit" onclick="editAsset(${index})">Edit</button>
              <button class="danger" onclick="deleteAsset(${index})">Delete</button>
            </td>
          `;
          tbody.appendChild(row);
        });
    }

    function addAsset() {
      const equipment = prompt("Enter Equipment:");
      if (!equipment) return;
      const description = prompt("Enter Equipment Description:");
      const serial = prompt("Enter Serial Number:");
      const dok = prompt("Enter DOK B-CORD:");
      const user = prompt("Enter User:");
      const location = prompt("Enter Location:");

      assetList.push({ equipment, description, serial, dok, user, location });
      saveData();
      showStatus("‚úÖ New record added successfully!");
    }

    function editAsset(index) {
      const asset = assetList[index];
      const equipment = prompt("Edit Equipment:", asset.equipment);
      if (equipment === null) return; // cancel

      const description = prompt("Edit Equipment Description:", asset.description);
      const serial = prompt("Edit Serial Number:", asset.serial);
      const dok = prompt("Edit DOK B-CORD:", asset.dok);
      const user = prompt("Edit User:", asset.user);
      const location = prompt("Edit Location:", asset.location);

      assetList[index] = { equipment, description, serial, dok, user, location };
      saveData();
      showStatus("‚úèÔ∏è Record updated successfully!");
    }

    function deleteAsset(index) {
      if (confirm("Are you sure you want to delete this record?")) {
        assetList.splice(index, 1);
        saveData();
        showStatus("üóëÔ∏è Record deleted!");
      }
    }

    function clearAll() {
      if (confirm("‚ö†Ô∏è This will permanently remove all records. Are you sure?")) {
        assetList = [];
        localStorage.removeItem('assetList');
        renderTable();
        showStatus("üßπ All data cleared!");
      }
    }

    // ‚úÖ Excel Import Function
    document.getElementById('fileInput').addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (!file) return;

      showStatus("üìÇ Reading Excel file...");
      const reader = new FileReader();

      reader.onload = function (evt) {
        const data = new Uint8Array(evt.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const firstSheetName = workbook.SheetNames[0];
        const sheet = workbook.Sheets[firstSheetName];
        const raw = XLSX.utils.sheet_to_json(sheet, { header: 1, defval: "" });

        if (raw.length < 2) {
          showStatus("‚ö†Ô∏è No valid data found in Excel.");
          return;
        }

        const headers = raw[0].map(h => h.replace(/\s+/g, ' ').trim());
        const rows = raw.slice(1);
        let added = 0;

        rows.forEach(r => {
          const obj = {};
          headers.forEach((h, i) => (obj[h] = r[i]));
          if (obj["Equipment"]) {
            assetList.push({
              equipment: obj["Equipment"] || "",
              description: obj["Equipment Description"] || "",
              serial: obj["Serial Number"] || "",
              dok: obj["DOK B-CORD"] || "",
              user: obj["User"] || "",
              location: obj["Location"] || ""
            });
            added++;
          }
        });

        saveData();
        showStatus(`‚úÖ Import successful! Rows added: ${added}`);
      };

      reader.readAsArrayBuffer(file);
    });

    function exportToCSV() {
      const ws = XLSX.utils.json_to_sheet(assetList);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Assets");
      XLSX.writeFile(wb, "asset_list.xlsx");
    }

    document.getElementById("searchInput").addEventListener("keyup", renderTable);
    document.getElementById("searchDok").addEventListener("keyup", renderTable);
    renderTable();
  </script>
</body>
</html>
