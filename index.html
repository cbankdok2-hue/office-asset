<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Office Asset Register</title>
<style>
body { font-family: Arial,sans-serif; background:#f4f6f8; margin:0; padding:20px; }
h2 { text-align:center; margin-bottom:20px; }
#controls { display:flex; justify-content:center; flex-wrap:wrap; gap:10px; margin-bottom:15px; }
input[type="text"]{ padding:8px; width:220px; border-radius:6px; border:1px solid #ccc; }
button { padding:8px 15px; border:none; border-radius:6px; background:#1976d2; color:white; cursor:pointer; }
button:hover{background:#1565c0;}
table{width:100%;border-collapse:collapse;background:white;border-radius:8px;overflow:hidden;}
th,td{border:1px solid #ddd;padding:8px;text-align:center;}
th{background:#1976d2;color:white;}
tr:nth-child(even){background:#f9f9f9;}
.edit-btn{background:#43a047;color:white;}
.delete-btn{background:#e53935;color:white;}
.edit-btn:hover{background:#2e7d32;}
.delete-btn:hover{background:#c62828;}
#status{text-align:center;margin-top:10px;font-style:italic;}
</style>
</head>
<body>

<h2>üè¢ Office Asset Register</h2>

<div id="controls">
  <button id="addRowBtn">‚ûï Add New Asset</button>
  <button id="exportExcel">üì§ Export to Excel</button>
  <input type="text" id="searchBox" placeholder="üîç Search...">
</div>

<table id="assetTable">
<thead>
<tr>
<th>Equipment</th>
<th>Equipment Description</th>
<th>Serial Number</th>
<th>DOK B-CORD</th>
<th>User</th>
<th>Location</th>
<th>Edit</th>
<th>Delete</th>
</tr>
</thead>
<tbody></tbody>
</table>

<p id="status">Ready.</p>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
const tableBody = document.querySelector("#assetTable tbody");
const status = document.getElementById("status");
const searchBox = document.getElementById("searchBox");
const API_URL = "https://script.google.com/macros/s/AKfycbw4DP4SZD70jlWw8K5c00uaaMg3HLOTrOwCrggF4PeBjkCm33XbqZtYN-T48RkNm-Urpg/exec"; // Replace with your deployed Apps Script URL

// Display data
function displayData(records){
  tableBody.innerHTML="";
  records.forEach(r=>{
    const row=document.createElement("tr");
    row.innerHTML = `<td>${r["Equipment"]||""}</td>
      <td>${r["Equipment Description"]||""}</td>
      <td>${r["Serial Number"]||""}</td>
      <td>${r["DOK B-CORD"]||""}</td>
      <td>${r["User"]||""}</td>
      <td>${r["Location"]||""}</td>
      <td><button class="edit-btn" onclick="editRow(this)">Edit</button></td>
      <td><button class="delete-btn" onclick="deleteRow(this)">Delete</button></td>`;
    tableBody.appendChild(row);
  });
  status.textContent=`‚úÖ Loaded ${records.length} assets.`;
}

// Load from API
async function loadFromAPI(){
  try{
    const res = await fetch(API_URL);
    const data = await res.json();
    displayData(data);
  }catch(e){
    console.error("‚ùå Failed to fetch:", e);
    status.textContent="‚ùå Cannot fetch data. Check Web App URL and deployment.";
  }
}

// POST helper
async function postToAPI(payload){
  try{
    const res = await fetch(API_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify(payload)
    });
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    return await res.json();
  }catch(e){
    console.error("‚ùå API POST error:", e);
    alert("‚ùå API error. Check console for details and Web App deployment.");
  }
}

// Edit Row
window.editRow = function(btn){
  const row = btn.parentNode.parentNode;
  const cells = row.querySelectorAll("td");
  if(btn.textContent==="Edit"){
    for(let i=0;i<cells.length-2;i++){cells[i].innerHTML=`<input value="${cells[i].textContent}">`;}
    btn.textContent="Save";
  } else {
    const values = Array.from(cells).slice(0,6).map(c=>c.querySelector("input").value);
    postToAPI({
      action:"edit",
      "Equipment":values[0],
      "Equipment Description":values[1],
      "Serial Number":values[2],
      "DOK B-CORD":values[3],
      "User":values[4],
      "Location":values[5]
    });
    for(let i=0;i<6;i++) cells[i].textContent = values[i];
    btn.textContent="Edit";
  }
};

// Delete Row
window.deleteRow = function(btn){
  const row = btn.parentNode.parentNode;
  const serial = row.children[2].textContent;
  if(confirm("Delete this asset?")){
    postToAPI({action:"delete","Serial Number":serial});
    row.remove();
  }
};

// Add New Row
document.getElementById("addRowBtn").addEventListener("click",()=>{
  const newRow=document.createElement("tr");
  newRow.innerHTML = `<td><input placeholder="Equipment"></td>
    <td><input placeholder="Equipment Description"></td>
    <td><input placeholder="Serial Number"></td>
    <td><input placeholder="DOK B-CORD"></td>
    <td><input placeholder="User"></td>
    <td><input placeholder="Location"></td>
    <td><button class="edit-btn" onclick="saveNewRow(this)">Save</button></td>
    <td><button class="delete-btn" onclick="deleteRow(this)">Delete</button></td>`;
  tableBody.appendChild(newRow);
});

window.saveNewRow = function(btn){
  const row = btn.parentNode.parentNode;
  const inputs = row.querySelectorAll("input");
  const values = Array.from(inputs).map(i=>i.value.trim());
  if(!values[2]){alert("Serial Number required"); return;}
  postToAPI({
    action:"add",
    "Equipment":values[0],
    "Equipment Description":values[1],
    "Serial Number":values[2],
    "DOK B-CORD":values[3],
    "User":values[4],
    "Location":values[5]
  });
  for(let i=0;i<6;i++) row.children[i].textContent=values[i];
  row.querySelector("button").textContent="Edit";
};

// Search
searchBox.addEventListener("keyup",()=>{
  const q = searchBox.value.toLowerCase();
  document.querySelectorAll("#assetTable tbody tr").forEach(row=>{
    row.style.display=row.textContent.toLowerCase().includes(q)?"":"none";
  });
});

// Export Excel
document.getElementById("exportExcel").addEventListener("click",()=>{
  const wb = XLSX.utils.book_new();
  const ws_data = [["Equipment","Equipment Description","Serial Number","DOK B-CORD","User","Location"]];
  document.querySelectorAll("#assetTable tbody tr").forEach(r=>{
    ws_data.push([...r.querySelectorAll("td")].slice(0,6).map(c=>c.textContent));
  });
  const ws = XLSX.utils.aoa_to_sheet(ws_data);
  XLSX.utils.book_append_sheet(wb,ws,"Assets");
  XLSX.writeFile(wb,"Office_Assets.xlsx");
});

// Auto refresh every 60s
setInterval(loadFromAPI,60000);
loadFromAPI();
</script>
</body>
</html>
